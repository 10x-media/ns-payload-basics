<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Invoice <%= order.orderNumber %>
    </title>
</head>

<body class="font-sans m-0 p-10 bg-gray-100 text-gray-900">
    <div class="max-w-3xl mx-auto bg-white p-8 rounded-lg border border-gray-200">
        <!-- Header -->
        <header class="flex justify-between items-start mb-8">
            <div class="text-sm leading-snug">
                <h1 class="m-0 font-semibold">Invoice</h1>
                <div class="text-gray-500 text-xs">Mercato Inc.</div>
                <div class="text-gray-500 text-xs">123 Main St. Â· 12345 City</div>
                <div class="text-gray-500 text-xs">info@mercato.com</div>
            </div>
            <div class="text-right text-sm leading-snug">
                <div><strong>Invoice No:</strong>
                    <%= order.orderNumber %>
                </div>
                <div><strong>Date:</strong>
                    <%= order.createdAtFormatted || order.createdAt %>
                </div>
            </div>
        </header>

        <!-- Customer & Shipping -->
        <section class="mb-6">
            <div class="flex gap-8 text-sm">
                <div class="flex-1">
                    <div class="text-sm font-semibold uppercase tracking-wider mb-2 text-gray-600">Billed To</div>
                    <div class="border border-gray-200 rounded-md p-3 bg-gray-50">
                        <div><strong>
                                <%= order.customer.name %>
                            </strong></div>
                        <div>
                            <%= order.customer.email %>
                        </div>
                    </div>
                </div>
                <div class="flex-1">
                    <div class="text-sm font-semibold uppercase tracking-wider mb-2 text-gray-600">Shipping Address
                    </div>
                    <div class="border border-gray-200 rounded-md p-3 bg-gray-50">
                        <div>
                            <%= order.shippingAddress.line1 %>
                        </div>
                        <div>
                            <%= order.shippingAddress.postalCode %>
                                <%= order.shippingAddress.city %>
                        </div>
                        <div>
                            <%= order.shippingAddress.country %>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Line Items -->
        <section class="mb-6">
            <div class="text-sm font-semibold uppercase tracking-wider mb-2 text-gray-600">Order Items</div>
            <table class="w-full border-collapse mt-2 text-sm">
                <thead>
                    <tr>
                        <th
                            class="p-2.5 border-b border-gray-200 text-left bg-gray-50 font-semibold text-xs uppercase tracking-wide text-gray-600">
                            Item</th>
                        <th
                            class="p-2.5 border-b border-gray-200 text-left bg-gray-50 font-semibold text-xs uppercase tracking-wide text-gray-600">
                            SKU / Vendor</th>
                        <th
                            class="p-2.5 border-b border-gray-200 text-right bg-gray-50 font-semibold text-xs uppercase tracking-wide text-gray-600">
                            Qty</th>
                        <th
                            class="p-2.5 border-b border-gray-200 text-right bg-gray-50 font-semibold text-xs uppercase tracking-wide text-gray-600">
                            Unit Price</th>
                        <th
                            class="p-2.5 border-b border-gray-200 text-right bg-gray-50 font-semibold text-xs uppercase tracking-wide text-gray-600">
                            Subtotal</th>
                    </tr>
                </thead>
                <tbody>
                    <% order.lineItems.forEach(function (item) { %>
                        <tr>
                            <td class="p-2.5 border-b border-gray-200 text-left">
                                <strong>
                                    <%= item.productSnapshot?.name || item.product?.name %>
                                </strong>
                                <% if (item.product?.description) { %>
                                    <div class="text-gray-500 text-xs">
                                        <%= item.product.description %>
                                    </div>
                                    <% } %>
                            </td>
                            <td class="p-2.5 border-b border-gray-200 text-left">
                                <% if (item.product?.metadata?.sku) { %>
                                    <div>SKU: <%= item.product.metadata.sku %>
                                    </div>
                                    <% } %>
                                        <% if (item.product?.metadata?.vendor) { %>
                                            <div class="text-gray-500 text-xs">
                                                <%= item.product.metadata.vendor %>
                                            </div>
                                            <% } %>
                            </td>
                            <td class="p-2.5 border-b border-gray-200 text-right">
                                <%= item.quantity %>
                            </td>
                            <td class="p-2.5 border-b border-gray-200 text-right">
                                <%= item.productSnapshot?.currency || "USD" %>
                                    <%= item.unitPrice.toFixed ? item.unitPrice.toFixed(2) : item.unitPrice %>
                            </td>
                            <td class="p-2.5 border-b border-gray-200 text-right">
                                <%= item.productSnapshot?.currency || "USD" %>
                                    <%= item.subtotal.toFixed ? item.subtotal.toFixed(2) : item.subtotal %>
                            </td>
                        </tr>
                        <% }) %>
                </tbody>
                <tfoot>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td class="p-2.5 border-b-0 text-sm text-right">Subtotal</td>
                        <td class="p-2.5 border-b-0 text-sm text-right">
                            <%= order.lineItems[0]?.productSnapshot?.currency || "USD" %>
                                <%= order.subtotal.toFixed ? order.subtotal.toFixed(2) : order.subtotal %>
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td></td>
                        <td class="p-2.5 border-b-0 text-sm text-right font-semibold border-t border-gray-300">Total
                        </td>
                        <td class="p-2.5 border-b-0 text-sm text-right font-semibold border-t border-gray-300">
                            <%= order.lineItems[0]?.productSnapshot?.currency || "USD" %>
                                <%= order.total.toFixed ? order.total.toFixed(2) : order.total %>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </section>

        <!-- Footer -->
        <section class="mb-6">
            <p class="text-gray-500 text-xs">
                Thank you for your order. Please include the invoice number in your payment reference.
            </p>
        </section>
    </div>
</body>

</html>